<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvoPolicy Demo</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #fff;
            color: #333;
        }

        h1 {
            border-bottom: 2px solid #eee;
            padding-bottom: 1rem;
        }

        .card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary {
            background: #0d6efd;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        input,
        select {
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        #result {
            background: #212529;
            color: #0f0;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: monospace;
            min-height: 100px;
        }
    </style>
</head>

<body>
    <h1>üõ°Ô∏è EvoPolicy Demo</h1>

    <div class="card">
        <h3>üë§ User Context</h3>
        <label>
            <strong>Role:</strong>
            <select id="role">
                <option value="manager">Manager</option>
                <option value="admin">Admin</option>
                <option value="user">User</option>
                <option value="editor">Editor</option>
                <option value="guest">Guest</option>
            </select>
        </label>
        <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(User ID: test-user-1)</span>
    </div>

    <div class="grid">
        <div class="card">
            <h3>üìÑ Invoice Action</h3>
            <p style="color: #666; font-size: 0.9em;">Policy: Manager can approve if amount &le; 1000</p>
            <div style="display: flex; gap: 10px; margin-top: 1rem;">
                <input type="number" id="amount" value="500" placeholder="Amount" style="width: 100px;">
                <button class="btn-primary" onclick="approveInvoice()">Approve Invoice</button>
            </div>
        </div>

        <div class="card">
            <h3>üõ¢Ô∏è Database Action</h3>
            <p style="color: #666; font-size: 0.9em;">Policy: Only Admin can delete database</p>
            <button class="btn-danger" style="width: 100%; margin-top: 1rem;" onclick="deleteDatabase()">Delete
                Database</button>
        </div>

        <div class="card">
            <h3>üë§ Profile Update (Regex)</h3>
            <p style="color: #666; font-size: 0.9em;">Policy: User can update if email matches `@company.com`</p>
            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 1rem;">
                <input type="text" id="email" value="test@company.com" placeholder="Email Address">
                <button class="btn-primary" onclick="updateProfile()">Update Profile</button>
            </div>
        </div>

        <div class="card">
            <h3>ÔøΩÔ∏è Article Publish (Date)</h3>
            <p style="color: #666; font-size: 0.9em;">Policy: Editor can publish if date is in the future</p>
            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 1rem;">
                <input type="date" id="publishDate" value="2026-01-01">
                <button class="btn-primary" onclick="publishArticle()">Publish Article</button>
            </div>
        </div>
    </div>

    <div>
        <h3>ÔøΩüìú Result</h3>
        <pre id="result">// Waiting for action...</pre>
    </div>

    <script>
        const getRole = () => document.getElementById('role').value;
        const setResult = (data) => {
            const el = document.getElementById('result');
            el.textContent = JSON.stringify(data, null, 2);
            el.style.color = data.error ? '#ff6b6b' : '#0f0';
        };

        async function approveInvoice() {
            const role = getRole();
            const amount = document.getElementById('amount').value;

            try {
                const res = await fetch('/api/invoices/approve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-role': role, 'x-user-id': 'test-user-1' },
                    body: JSON.stringify({ amount: Number(amount) })
                });
                const data = await res.json();
                setResult(data);
            } catch (err) {
                setResult({ error: err.message });
            }
        }

        async function deleteDatabase() {
            const role = getRole();
            try {
                const res = await fetch('/api/database', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json', 'x-role': role, 'x-user-id': 'test-user-1' }
                });
                const data = await res.json();
                setResult(data);
            } catch (err) {
                setResult({ error: err.message });
            }
        }

        async function updateProfile() {
            const role = getRole();
            const email = document.getElementById('email').value;
            try {
                const res = await fetch('/api/profile/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-role': role, 'x-user-id': 'test-user-1' },
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                setResult(data);
            } catch (err) {
                setResult({ error: err.message });
            }
        }

        async function publishArticle() {
            const role = getRole();
            const publishDate = document.getElementById('publishDate').value;
            try {
                const res = await fetch('/api/articles/publish', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-role': role, 'x-user-id': 'test-user-1' },
                    body: JSON.stringify({ publishDate })
                });
                const data = await res.json();
                setResult(data);
            } catch (err) {
                setResult({ error: err.message });
            }
        }
    </script>
</body>

</html>